"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5604],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return h}});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),l=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=l(e.components);return a.createElement(s.Provider,{value:n},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=d(e,["components","mdxType","originalType","parentName"]),c=l(t),u=r,h=c["".concat(s,".").concat(u)]||c[u]||m[u]||i;return t?a.createElement(h,o(o({ref:n},p),{},{components:t})):a.createElement(h,o({ref:n},p))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=u;var d={};for(var s in n)hasOwnProperty.call(n,s)&&(d[s]=n[s]);d.originalType=e,d[c]="string"==typeof e?e:r,o[1]=d;for(var l=2;l<i;l++)o[l]=t[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},5162:function(e,n,t){t.d(n,{Z:function(){return o}});var a=t(7294),r=t(4334),i={tabItem:"tabItem_Ymn6"};function o(e){let{children:n,hidden:t,className:o}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(i.tabItem,o),hidden:t},n)}},4866:function(e,n,t){t.d(n,{Z:function(){return w}});var a=t(3117),r=t(7294),i=t(4334),o=t(2466),d=t(6550),s=t(1980),l=t(7392),p=t(12);function c(e){return function(e){return r.Children.map(e,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:n,label:t,attributes:a,default:r}}=e;return{value:n,label:t,attributes:a,default:r}}))}function m(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??c(t);return function(e){const n=(0,l.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function u(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function h(e){let{queryString:n=!1,groupId:t}=e;const a=(0,d.k6)(),i=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,s._X)(i),(0,r.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(a.location.search);n.set(i,e),a.replace({...a.location,search:n.toString()})}),[i,a])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:a}=e,i=m(e),[o,d]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!u({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const a=t.find((e=>e.default))??t[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:i}))),[s,l]=h({queryString:t,groupId:a}),[c,f]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[a,i]=(0,p.Nk)(t);return[a,(0,r.useCallback)((e=>{t&&i.set(e)}),[t,i])]}({groupId:a}),g=(()=>{const e=s??c;return u({value:e,tabValues:i})?e:null})();(0,r.useLayoutEffect)((()=>{g&&d(g)}),[g]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!u({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);d(e),l(e),f(e)}),[l,f,i]),tabValues:i}}var g=t(2389),k={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function y(e){let{className:n,block:t,selectedValue:d,selectValue:s,tabValues:l}=e;const p=[],{blockElementScrollPositionUntilNextRender:c}=(0,o.o5)(),m=e=>{const n=e.currentTarget,t=p.indexOf(n),a=l[t].value;a!==d&&(c(n),s(a))},u=e=>{let n=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const t=p.indexOf(e.currentTarget)+1;n=p[t]??p[0];break}case"ArrowLeft":{const t=p.indexOf(e.currentTarget)-1;n=p[t]??p[p.length-1];break}}n?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":t},n)},l.map((e=>{let{value:n,label:t,attributes:o}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:d===n?0:-1,"aria-selected":d===n,key:n,ref:e=>p.push(e),onKeyDown:u,onClick:m},o,{className:(0,i.Z)("tabs__item",k.tabItem,o?.className,{"tabs__item--active":d===n})}),t??n)})))}function v(e){let{lazy:n,children:t,selectedValue:a}=e;if(t=Array.isArray(t)?t:[t],n){const e=t.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},t.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==a}))))}function b(e){const n=f(e);return r.createElement("div",{className:(0,i.Z)("tabs-container",k.tabList)},r.createElement(y,(0,a.Z)({},e,n)),r.createElement(v,(0,a.Z)({},e,n)))}function w(e){const n=(0,g.Z)();return r.createElement(b,(0,a.Z)({key:String(n)},e))}},9667:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return s},default:function(){return h},frontMatter:function(){return d},metadata:function(){return l},toc:function(){return c}});var a=t(3117),r=(t(7294),t(3905)),i=t(4866),o=t(5162);const d={},s="Migrating from AFJ 0.3.x to 0.4.x",l={unversionedId:"updating/versions/0.3-to-0.4",id:"version-0.3/updating/versions/0.3-to-0.4",title:"Migrating from AFJ 0.3.x to 0.4.x",description:"This document describes everything you need to know for updating AFJ 0.3.x to 0.4.x. If you're not aware of how updating in AFJ works make sure to first read the guide on Updating AFJ.",source:"@site/versioned_docs/version-0.3/updating/versions/0.3-to-0.4.md",sourceDirName:"updating/versions",slug:"/updating/versions/0.3-to-0.4",permalink:"/guides/updating/versions/0.3-to-0.4",draft:!1,tags:[],version:"0.3",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Migrating from AFJ 0.2.x to 0.3.x",permalink:"/guides/updating/versions/0.2-to-0.3"},next:{title:"The Aries JavaScript Ecosystem",permalink:"/guides/ecosystem/"}},p={},c=[{value:"React Native",id:"react-native",level:4},{value:"Node",id:"node",level:4},{value:"Breaking Code Changes",id:"breaking-code-changes",level:2},{value:"Agent Creation",id:"agent-creation",level:3},{value:"0.3.x",id:"03x",level:5},{value:"0.4.x",id:"04x",level:5},{value:"Indy Network Configuration",id:"indy-network-configuration",level:3},{value:"0.3.x",id:"03x-1",level:5},{value:"0.4.x",id:"04x-1",level:5},{value:"Changes to wallet",id:"changes-to-wallet",level:3},{value:"Did Resolver and Registrar",id:"did-resolver-and-registrar",level:3},{value:"0.3.x",id:"03x-2",level:5},{value:"0.4.x",id:"04x-2",level:5},{value:"Removal of <code>publicDidSeed</code> and <code>publicDid</code>",id:"removal-of-publicdidseed-and-publicdid",level:3},{value:"0.3.x",id:"03x-3",level:5},{value:"0.4.x",id:"04x-3",level:5},{value:"More Granular Usage of Legacy <code>did:sov</code> Prefix in DIDComm Messages",id:"more-granular-usage-of-legacy-didsov-prefix-in-didcomm-messages",level:3},{value:"0.3.x",id:"03x-4",level:5},{value:"0.4.x",id:"04x-4",level:5},{value:"Removal of <code>injectionContainer</code> property from the agent",id:"removal-of-injectioncontainer-property-from-the-agent",level:3},{value:"<code>connection</code> has been updated to <code>connectionId</code> in <code>TransportSession</code>",id:"connection-has-been-updated-to-connectionid-in-transportsession",level:3},{value:"Replacment of Ledger Module with new AnonCreds Module",id:"replacment-of-ledger-module-with-new-anoncreds-module",level:3},{value:"0.3.x",id:"03x-5",level:5},{value:"0.4.x",id:"04x-5",level:5},{value:"Changes to the Credentials and Proofs modules",id:"changes-to-the-credentials-and-proofs-modules",level:3},{value:"Changes to the AnonCreds Credential and Proof Format",id:"changes-to-the-anoncreds-credential-and-proof-format",level:3},{value:"0.3.x",id:"03x-6",level:5},{value:"0.4.x",id:"04x-6",level:5},{value:"Removal of AnonCreds Master Secret maangement from <code>Wallet</code>",id:"removal-of-anoncreds-master-secret-maangement-from-wallet",level:3},{value:"Default Outbound DIDComm Content Type now <code>application/didcomm-envelope-enc</code>",id:"default-outbound-didcomm-content-type-now-applicationdidcomm-envelope-enc",level:3},{value:"0.3.x",id:"03x-7",level:5},{value:"0.4.x",id:"04x-7",level:5},{value:"Generalizing Indy properties in <code>CredentialExchangeRecord</code>",id:"generalizing-indy-properties-in-credentialexchangerecord",level:3},{value:"<code>credentialRecordType</code>",id:"credentialrecordtype",level:4},{value:"0.3.x",id:"03x-8",level:5},{value:"0.4.x",id:"04x-8",level:5},{value:"Metadata",id:"metadata",level:4},{value:"0.3.x",id:"03x-9",level:5},{value:"0.4.x",id:"04x-9",level:5},{value:"More paths in <code>FileSystem</code>",id:"more-paths-in-filesystem",level:3},{value:"Breaking Storage Changes",id:"breaking-storage-changes",level:2}],m={toc:c},u="wrapper";function h(e){let{components:n,...t}=e;return(0,r.kt)(u,(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"migrating-from-afj-03x-to-04x"},"Migrating from AFJ 0.3.x to 0.4.x"),(0,r.kt)("p",null,"This document describes everything you need to know for updating AFJ 0.3.x to 0.4.x. If you're not aware of how updating in AFJ works make sure to first read the guide on ",(0,r.kt)("a",{parentName:"p",href:"/guides/next/updating/"},"Updating AFJ"),"."),(0,r.kt)("p",null,"First of all, update you dependencies to the 0.4.x versions. This will also update the needed peer depedencnies. ",(0,r.kt)("strong",{parentName:"p"},"Extension packages are not updated with this command"),". You need to update these manually, and make sure they're up to date with the latest version of AFJ."),(0,r.kt)("p",null,"Aries Framework JavaScript 0.4.0 is a major release that introduces a lot of new features and changes to the public API. Specifically, this release removed the dependency on the Indy SDK from the ",(0,r.kt)("inlineCode",{parentName:"p"},"@aries-framework/core")," package. Agent setup is more flexible, but it also means the setup is more complex. Follow the mentioned steps in this document carefully to make the upgrade as smooth as possible."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"The migration guide only covers how to migrate from 0.3.x to 0.4.x while keeping the same behaviour and dependencies. AFJ 0.4.0 introduced a lot of new features and adds support for ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/aries-askar"},"Aries Askar"),", ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/indy-vdr"},"Indy VDR")," and ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/anoncreds-rs"},"AnonCreds RS")," as a replacement for the Indy SDK."),(0,r.kt)("p",{parentName:"admonition"},"Migrating to these new components requires additional migration steps, which need to be cloesly followed to prevent loss of data. Separate documentation will be made avaialable for migration to these new components.")),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{label:"React Native",value:"tab1",mdxType:"TabItem"},(0,r.kt)("p",null,"First install the updated dependencies. Make sure to also install the new ",(0,r.kt)("inlineCode",{parentName:"p"},"@aries-framework/indy-sdk")," package, which is a wrapper around the Indy SDK and install the ",(0,r.kt)("inlineCode",{parentName:"p"},"indy-sdk-react-native")," package."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"yarn add @aries-framework/react-native@^0.4.0 @aries-framework/core@^0.4.0 @aries-framework/indy-sdk@^0.4.0 @aries-framework/anoncreds@^0.4.0 indy-sdk-react-native@^0.3.1\n\n# or NPM\nnpn install @aries-framework/react-native@^0.4.0 @aries-framework/core@^0.4.0 @aries-framework/indy-sdk@^0.4.0 @aries-framework/anoncreds@^0.4.0 indy-sdk-react-native@^0.3.1\n")),(0,r.kt)("p",null,"We also need to install types for the ",(0,r.kt)("inlineCode",{parentName:"p"},"indy-sdk-react-native")," package, which we take from the ",(0,r.kt)("inlineCode",{parentName:"p"},"@types/indy-sdk")," package."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"yarn add --dev @types/indy-sdk-react-native@npm:@types/indy-sdk\n\n# or NPM\nnpm install --save-dev @types/indy-sdk-react-native@npm:@types/indy-sdk\n"))),(0,r.kt)(o.Z,{label:"Node",value:"tab2",mdxType:"TabItem"},(0,r.kt)("p",null,"First install the updated dependencies. Make sure to also install the new ",(0,r.kt)("inlineCode",{parentName:"p"},"@aries-framework/indy-sdk")," package, which is a wrapper around the Indy SDK and install the ",(0,r.kt)("inlineCode",{parentName:"p"},"indy-sdk")," package itself."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"yarn add @aries-framework/node@^0.4.0 @aries-framework/core@^0.4.0  @aries-framework/indy-sdk@^0.4.0 @aries-framework/anoncreds@^0.4.0 indy-sdk\n\n# or NPM\nnpm install @aries-framework/node@^0.4.0 @aries-framework/core@^0.4.0  @aries-framework/indy-sdk@^0.4.0 @aries-framework/anoncreds@^0.4.0 indy-sdk\n")),(0,r.kt)("p",null,"We also need to install types for the ",(0,r.kt)("inlineCode",{parentName:"p"},"indy-sdk")," package, which are available in the ",(0,r.kt)("inlineCode",{parentName:"p"},"@types/indy-sdk")," package."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"yarn add --dev @types/indy-sdk\n\n# or NPM\nnpm install --save-dev @types/indy-sdk\n")))),(0,r.kt)("h2",{id:"breaking-code-changes"},"Breaking Code Changes"),(0,r.kt)("p",null,"This section will list all breaking changes made to the public API of AFJ between version 0.3.x and 0.4.0."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"If you have custom modules take into account there could be a lot more breaking changes that aren't documented here. We try to make sure that the biggest breaking changes to the internal API are also documented here, but it is possible some breaking changes are not documented here (feel free to open PRs).")),(0,r.kt)("h3",{id:"agent-creation"},"Agent Creation"),(0,r.kt)("p",null,"With the dependency on the Indy SDK removed from the ",(0,r.kt)("inlineCode",{parentName:"p"},"@aries-framework/core")," package, we now need to register the ",(0,r.kt)("inlineCode",{parentName:"p"},"InydSdkModule")," to still leverage the functionality the Indy SDK provides."),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{label:"0.3.x",value:"tab1",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Agent } from '@aries-framework/core'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\nconst agent = new Agent({\n  config: {\n    /* ... */\n  },\n  dependencies: agentDependencies,\n})\n"))),(0,r.kt)(o.Z,{label:"0.4.x",value:"tab2",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Agent } from '@aries-framework/core'\nimport { IndySdkModule } from '@aries-framework/indy-sdk'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\n// Import from indy-sdk-react-native in React Native\nimport indySdk from 'indy-sdk'\n\nconst agent = new Agent({\n  config: {\n    /* ... */\n  },\n  dependencies: agentDependencies,\n  modules: {\n    // Register the IndySdkModule and provide the indySdk depedency\n    indySdk: new IndySdkModule({\n      indySdk,\n    }),\n  },\n})\n")))),(0,r.kt)("h3",{id:"indy-network-configuration"},"Indy Network Configuration"),(0,r.kt)("p",null,"With the Indy SDK being extracted out of core, the ",(0,r.kt)("inlineCode",{parentName:"p"},"indyLedger")," config option is no longer available on the ",(0,r.kt)("inlineCode",{parentName:"p"},"AgentConfig")," interface. Instead, the ",(0,r.kt)("inlineCode",{parentName:"p"},"networks")," config option is now available on the ",(0,r.kt)("inlineCode",{parentName:"p"},"IndySdkModule")," config."),(0,r.kt)("p",null,"In addition the ",(0,r.kt)("inlineCode",{parentName:"p"},"connectToIndyLedgersOnStartup")," property has been removed in favour of a per-network ",(0,r.kt)("inlineCode",{parentName:"p"},"connectOnStartup")," property that allows more fine-grained control over which networks to connect to on startup."),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{label:"0.3.x",value:"tab1",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Agent } from '@aries-framework/core'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\nconst agent = new Agent({\n  config: {\n    connectToIndyLedgersOnStartup: true,\n    indyLedgers: [\n      {\n        id: 'Sovrin Mainnet',\n        indyNamespace: 'sovrin',\n        isProduction: true,\n        genesisPath: './genesis/sovrin-genesis.txn',\n      },\n    ],\n  },\n  dependencies: agentDependencies,\n})\n"))),(0,r.kt)(o.Z,{label:"0.4.x",value:"tab2",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Agent } from '@aries-framework/core'\nimport { IndySdkModule } from '@aries-framework/indy-sdk'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\n// Import from indy-sdk-react-native in React Native\nimport indySdk from 'indy-sdk'\n\nconst agent = new Agent({\n  config: {\n    /* ... */\n  },\n  dependencies: agentDependencies,\n  modules: {\n    // Register the IndySdkModule and provide the indySdk depedency\n    indySdk: new IndySdkModule({\n      indySdk,\n\n      // add networks as a replacement for indyLedgers\n      networks: [\n        {\n          id: 'Sovrin Mainnet',\n          indyNamespace: 'sovrin',\n          isProduction: true,\n          genesisPath: './genesis/sovrin-genesis.txn',\n          // new connectOnStartup property\n          connectOnStartup: true,\n        },\n      ],\n    }),\n  },\n})\n")))),(0,r.kt)("h3",{id:"changes-to-wallet"},"Changes to wallet"),(0,r.kt)("p",null,"Throughout the framework it was possible to provide a ",(0,r.kt)("inlineCode",{parentName:"p"},"seed")," for deterministic key generation. Recently it was discovered that the ",(0,r.kt)("inlineCode",{parentName:"p"},"seed")," property in the Indy SDK was not actually used as a seed, but directly as the private key."),(0,r.kt)("p",null,"Therefore a new ",(0,r.kt)("inlineCode",{parentName:"p"},"privateKey")," property was added to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Wallet")," interface in addition to the ",(0,r.kt)("inlineCode",{parentName:"p"},"seed")," property. When using the ",(0,r.kt)("inlineCode",{parentName:"p"},"IndySdkModule")," this now means you can ",(0,r.kt)("strong",{parentName:"p"},"only")," provide the ",(0,r.kt)("inlineCode",{parentName:"p"},"privateKey")," property. The ",(0,r.kt)("inlineCode",{parentName:"p"},"seed")," property is no longer supported ",(0,r.kt)("strong",{parentName:"p"},"by the ",(0,r.kt)("inlineCode",{parentName:"strong"},"IndySdkModule")),"."),(0,r.kt)("p",null,"The type of the ",(0,r.kt)("inlineCode",{parentName:"p"},"seed")," property has also been changed to ",(0,r.kt)("inlineCode",{parentName:"p"},"Buffer")," to make it more consistent with ",(0,r.kt)("inlineCode",{parentName:"p"},"privateKey")," property, and remove the ambiguity of what the encoding of the string variant of the ",(0,r.kt)("inlineCode",{parentName:"p"},"seed")," property should be."),(0,r.kt)("h3",{id:"did-resolver-and-registrar"},"Did Resolver and Registrar"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"did:sov")," resolver and registrar were registered by default in 0.3.x of the agent. In 0.4.0 they've been moved to the ",(0,r.kt)("inlineCode",{parentName:"p"},"@aries-framework/indy-sdk")," package and are thus not registered by default on the dids module anymore. In addition, the ",(0,r.kt)("inlineCode",{parentName:"p"},"IndySdkSovDidRegistrar")," has been replaced in favour of the ",(0,r.kt)("inlineCode",{parentName:"p"},"IndySdkIndyDidRegistrar")," which provides similar behaviour, but leverages the new ",(0,r.kt)("a",{parentName:"p",href:"https://hyperledger.github.io/indy-did-method/#indy-did-method-identifiers"},(0,r.kt)("inlineCode",{parentName:"a"},"did:indy")," method"),", which removes ambiguity about which network to use. You can still use the ",(0,r.kt)("inlineCode",{parentName:"p"},"IndySdkSovDidResolver")," to resolve ",(0,r.kt)("inlineCode",{parentName:"p"},"did:sov")," dids."),(0,r.kt)("p",null,"Note that the ",(0,r.kt)("inlineCode",{parentName:"p"},"IndySdkModule")," MUST be registered when using the indy sdk did resolvers and registrars (see ",(0,r.kt)("a",{parentName:"p",href:"#agent-creation"},"Agent Creation"),"). The networks supported by the resolvers and registrar is determined by the ",(0,r.kt)("inlineCode",{parentName:"p"},"networks")," registered on the ",(0,r.kt)("inlineCode",{parentName:"p"},"IndySdkModule")," (see ",(0,r.kt)("a",{parentName:"p",href:"#indy-network-configuration"},"Indy Network Configuration"),")."),(0,r.kt)("p",null,"Also note that by default the ",(0,r.kt)("inlineCode",{parentName:"p"},"WebDidResolver"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"KeyDidResolver")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"PeerDidResolver")," are registered, and setting the ",(0,r.kt)("inlineCode",{parentName:"p"},"resolvers")," property on the ",(0,r.kt)("inlineCode",{parentName:"p"},"DidsModule")," config will override the default resolvers (an exception is the ",(0,r.kt)("inlineCode",{parentName:"p"},"PeerDidResolver")," as it is required for creating connections, and thus will always be registered)."),(0,r.kt)("p",null,"The same thing is true for the ",(0,r.kt)("inlineCode",{parentName:"p"},"registrars"),", for which the ",(0,r.kt)("inlineCode",{parentName:"p"},"KeyDidRegistrar")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"PeerDidRegistrar")," are registered by default. If defining the ",(0,r.kt)("inlineCode",{parentName:"p"},"resolvers")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"registrars"),", make sure to include the default registrars if you want to keep the previous behaviour."),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{label:"0.3.x",value:"tab1",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Agent } from '@aries-framework/core'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\nconst agent = new Agent({\n  config: {\n    /* ... */\n  },\n  dependencies: agentDependencies,\n})\n"))),(0,r.kt)(o.Z,{label:"0.4.x",value:"tab2",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Agent, DidsModule } from '@aries-framework/core'\nimport { IndySdkModule } from '@aries-framework/indy-sdk'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\nconst agent = new Agent({\n  config: {\n    /* ... */\n  },\n  dependencies: agentDependencies,\n  modules: {\n    // note that the IndySdkModule MUST be registered for the resolvers and registrars to work\n    // they are left out for brevity and can bee\n    dids: new DidsModule({\n      registrars: [new IndySdkIndyDidRegistrar()],\n      resolvers: [new IndySdkSovDidResolver(), new IndySdkIndyDidResolver()],\n    }),\n  },\n})\n")))),(0,r.kt)("h3",{id:"removal-of-publicdidseed-and-publicdid"},"Removal of ",(0,r.kt)("inlineCode",{parentName:"h3"},"publicDidSeed")," and ",(0,r.kt)("inlineCode",{parentName:"h3"},"publicDid")),(0,r.kt)("p",null,"To make AFJ more generic, and less focused on Hyperledger Indy, and indy dids, the ",(0,r.kt)("inlineCode",{parentName:"p"},"publicDidSeed")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"publicDid")," properties have been removed from the agent configuration, the agent class, and the ",(0,r.kt)("inlineCode",{parentName:"p"},"Wallet")," interface."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"publicDid")," property was used as the did to register items in the ledger module. The approach had some limitations:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"An agent could only have a single ",(0,r.kt)("inlineCode",{parentName:"li"},"publicDid")," property. This means that if you wanted to write to multiple ledgers you would have to create multiple agents"),(0,r.kt)("li",{parentName:"ul"},"The property assumed only Indy ledgers would be used, and didn't take into account the possibility of other ledgers.")),(0,r.kt)("p",null,"AFJ now provides generic APIs that can work with any ledger, and thus the ",(0,r.kt)("inlineCode",{parentName:"p"},"publicDid")," property is no longer needed. Different sections of this migration guide will explain the different parts of how to use the new APIs, this section just focuses on how to replace the ",(0,r.kt)("inlineCode",{parentName:"p"},"publicDid")," property."),(0,r.kt)("p",null,"The most common use case for the ",(0,r.kt)("inlineCode",{parentName:"p"},"publicDid")," property was for registering an endorser did that can endorse (read: pay for) transactions on the ledger. This can now be done by importing the did into agent, aftre which it can be used by the anoncreds module to register schemas and credential definitions, and the did registrar to register dids."),(0,r.kt)("p",null,"There's a ",(0,r.kt)("strong",{parentName:"p"},"one-time import")," that needs to be done to import the did into the agent using the ",(0,r.kt)("inlineCode",{parentName:"p"},"DidsApi.import")," method. If you've previously used the ",(0,r.kt)("inlineCode",{parentName:"p"},"publicDidSeed")," property, providing the private key is optional, as it is already stored in the wallet. Note that the ",(0,r.kt)("inlineCode",{parentName:"p"},"privateKey")," is the same as the ",(0,r.kt)("inlineCode",{parentName:"p"},"publicDidSeed"),", see ",(0,r.kt)("a",{parentName:"p",href:"#changes-to-wallet"},"Changes to Wallet")," for context). The ",(0,r.kt)("inlineCode",{parentName:"p"},"import")," method will resolve the did passed to the ",(0,r.kt)("inlineCode",{parentName:"p"},"import")," method (so make sure to regiser the ",(0,r.kt)("inlineCode",{parentName:"p"},"IndySdkIndyDidResolver"),"). It is recommended to import the endorser did as an ",(0,r.kt)("inlineCode",{parentName:"p"},"did:indy")," did rather than a ",(0,r.kt)("inlineCode",{parentName:"p"},"did:sov")," did, as the ",(0,r.kt)("inlineCode",{parentName:"p"},"did:sov")," method is deprecated for creation. The ",(0,r.kt)("inlineCode",{parentName:"p"},"did:indy")," did can be constructed by replacing ",(0,r.kt)("inlineCode",{parentName:"p"},"sov")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"indy:<indyNamespace>"),", where ",(0,r.kt)("inlineCode",{parentName:"p"},"<indyNamespace>")," should be replaced with a namespace as registered in the ",(0,r.kt)("inlineCode",{parentName:"p"},"networks")," property of the ",(0,r.kt)("inlineCode",{parentName:"p"},"IndySdkModule")," (see ",(0,r.kt)("a",{parentName:"p",href:"#indy-network-configuration"},"Indy Network Configuration"),")."),(0,r.kt)("p",null,"An inital list of namespace identifiers can be found in an ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/indy-did-networks/issues/3"},"issue in the Indy Did Networks Repository"),". In the future this list will be maintained in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/indy-did-networks"},"Indy DID Networks repository")," itself."),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{label:"0.3.x",value:"tab1",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Agent } from '@aries-framework/core'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\nconst agent = new Agent({\n  config: {\n    publicDidSeed: '01eafa4de4e22ed4fc2ee522b6ce2731',\n  },\n  dependencies: agentDependencies,\n})\n"))),(0,r.kt)(o.Z,{label:"0.4.x",value:"tab2",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Agent, DidsModule, KeyType, TypedArrayEncoder } from '@aries-framework/core'\nimport { IndySdkModule, IndySdkIndyDidResolver } from '@aries-framework/indy-sdk'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\n// Import from indy-sdk-react-native in React Native\nimport indySdk from 'indy-sdk'\n\nconst agent = new Agent({\n  config: {\n    /* ... */\n  },\n  dependencies: agentDependencies,\n  modules: {\n    indySdk: new IndySdkModule({\n      indySdk,\n      networks: [\n        {\n          id: 'Sovrin Mainnet',\n          // Important: make sure to pick the correct indy namespace for the network you're connecting to\n          // See: https://github.com/hyperledger/indy-did-networks/issues/3\n          indyNamespace: 'sovrin',\n          isProduction: true,\n          genesisPath: './genesis/sovrin-genesis.txn',\n        },\n      ],\n    }),\n    dids: new DidsModule({\n      // Important: Make sure to register the IndySdkIndyDidResolver\n      resolvers: [new IndySdkIndyDidResolver()],\n    }),\n  },\n})\n\n// Important: the `import` method only has to be called once, and the agent MSUT be initialized before calling it.\n// The private key is optional if you've used the publicDidSeed property before (as the key will already be in the wallet),\nawait agent.initialize()\nawait agent.dids.import({\n  did: 'did:indy:sovrin:KEPUoXHcswsfsHkXGfmXB7',\n  privateKeys: [\n    {\n      keyType: KeyType.Ed25519,\n      privateKey: TypedArrayEncoder.fromString('01eafa4de4e22ed4fc2ee522b6ce2731'),\n    },\n  ],\n})\n")))),(0,r.kt)("h3",{id:"more-granular-usage-of-legacy-didsov-prefix-in-didcomm-messages"},"More Granular Usage of Legacy ",(0,r.kt)("inlineCode",{parentName:"h3"},"did:sov")," Prefix in DIDComm Messages"),(0,r.kt)("p",null,"AFJ 0.3.0 used the ",(0,r.kt)("inlineCode",{parentName:"p"},"useLegacyDidSovPrefix")," to use the legacy ",(0,r.kt)("inlineCode",{parentName:"p"},"did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/")," as the prefix in the ",(0,r.kt)("inlineCode",{parentName:"p"},"@type")," of DIDComm message instead of the new ",(0,r.kt)("inlineCode",{parentName:"p"},"https://didcomm.org")," prefix. Over time it has proven that this approach leads to undersired behaviour as all messages (even protocols that were defined after the new prefix was the default) would use the legacy prefix. However, due to not all implementations having support for new prefix, disabling the legacy prefixes proved to be a problem."),(0,r.kt)("p",null,"Therefore, in AFJ 0.4.0 the ",(0,r.kt)("inlineCode",{parentName:"p"},"useLegacyDidSovPrefix")," property has been replaced with the ",(0,r.kt)("inlineCode",{parentName:"p"},"useDidSovPrefixWhereAllowed")," property. This property will only use the legacy prefix for protocols that were defined before the new prefix was the default. This means that protocols that were defined after the new prefix was the default will use the new prefix independant of the value of the ",(0,r.kt)("inlineCode",{parentName:"p"},"useDidSovPrefixWhereAllowed")," property. We hope this will allow us to slowly migrate away from the legacy prefix as new protocols are defined without breaking backwards compatibility."),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{label:"0.3.x",value:"tab1",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Agent } from '@aries-framework/core'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\nconst agent = new Agent({\n  config: {\n    useLegacyDidSovPrefix: true,\n  },\n  dependencies: agentDependencies,\n})\n"))),(0,r.kt)(o.Z,{label:"0.4.x",value:"tab2",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Agent } from '@aries-framework/core'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\nconst agent = new Agent({\n  config: {\n    useDidSovPrefixWhereAllowed: true,\n  },\n  dependencies: agentDependencies,\n})\n")))),(0,r.kt)("h3",{id:"removal-of-injectioncontainer-property-from-the-agent"},"Removal of ",(0,r.kt)("inlineCode",{parentName:"h3"},"injectionContainer")," property from the agent"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"injectionContainer")," property on the ",(0,r.kt)("inlineCode",{parentName:"p"},"Agent")," has been replaced by the ",(0,r.kt)("inlineCode",{parentName:"p"},"dependencyManager")," property. The ",(0,r.kt)("inlineCode",{parentName:"p"},"dependencyManager")," property is an instance of the ",(0,r.kt)("inlineCode",{parentName:"p"},"DependencyManager")," class and wraps the injection container from ",(0,r.kt)("inlineCode",{parentName:"p"},"tsyringe"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"DependencyManager")," ",(0,r.kt)("em",{parentName:"p"},"should")," provide all functionality that is needed, and it is recommended to not use the injection direclty. If you need to use the injection container directly, you can access it via the ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," property on the ",(0,r.kt)("inlineCode",{parentName:"p"},"DependencyManager")," instance, but please raise an issue to discuss if the functionality you need should be added to the ",(0,r.kt)("inlineCode",{parentName:"p"},"DependencyManager")," class."),(0,r.kt)("h3",{id:"connection-has-been-updated-to-connectionid-in-transportsession"},(0,r.kt)("inlineCode",{parentName:"h3"},"connection")," has been updated to ",(0,r.kt)("inlineCode",{parentName:"h3"},"connectionId")," in ",(0,r.kt)("inlineCode",{parentName:"h3"},"TransportSession")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"connection")," property on the ",(0,r.kt)("inlineCode",{parentName:"p"},"TransportSession")," has been changed to ",(0,r.kt)("inlineCode",{parentName:"p"},"connectionId")," and now only holds a reference to the connection id instead of the connection record itself."),(0,r.kt)("p",null,"Accessing the connection on a transport session is an advanced case that is mostly only relevant when implementing a custom transport. If you are using the default transports, you should not be affected by this change."),(0,r.kt)("h3",{id:"replacment-of-ledger-module-with-new-anoncreds-module"},"Replacment of Ledger Module with new AnonCreds Module"),(0,r.kt)("p",null,"The ledger module has been availalbe in AFJ since the very beginning and was due for a big overhaul. With the addition of the dids module a while ago we already had a replacement for the ",(0,r.kt)("inlineCode",{parentName:"p"},"registerPublicDid")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"getPublicDid")," methods on the ledger module. The other methods of the ledger module have been replaced by the AnonCreds module."),(0,r.kt)("p",null,"In AFJ 0.4.0 AnonCreds credential support is not part of the core framework anymore, and needs to be manually registerd on the agent. The first part is enabling the AnonCreds module, which allows to manage anoncreds objects, interact with the ledger, and issuer, hold and verify AnonCreds credentials and is explained in this section. The second part is actually allowing AnonCreds credentials to be exchanged in the Issue Credential and Present Proof protocols, which is explained in the ",(0,r.kt)("a",{parentName:"p",href:"#manually-register-anoncreds-support-in-credentials-and-proofs-modules"},"Manually Register AnonCreds Support in Credentials and Proofs Modules")," section."),(0,r.kt)("p",null,"There's a few important take-aways based on the code example below:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"anoncreds")," module can be accessed under the ",(0,r.kt)("inlineCode",{parentName:"li"},"agent.modules.anoncreds")," property."),(0,r.kt)("li",{parentName:"ul"},"The interfaces are set up as generically as possible based on the ",(0,r.kt)("a",{parentName:"li",href:"https://identity.foundation/did-registration/"},"DID Registration")," and ",(0,r.kt)("a",{parentName:"li",href:"https://w3c-ccg.github.io/did-resolution/"},"DID Resolution")," specifications."),(0,r.kt)("li",{parentName:"ul"},"AnonCreds registries need to be manually registered so it's important to register the ",(0,r.kt)("inlineCode",{parentName:"li"},"IndySdkAnonCredsRegistry")," on the ",(0,r.kt)("inlineCode",{parentName:"li"},"AnonCredsModule"),"."),(0,r.kt)("li",{parentName:"ul"},"It is now required to pass an ",(0,r.kt)("inlineCode",{parentName:"li"},"issuerId")," when registering AnonCreds objects, according to the ",(0,r.kt)("a",{parentName:"li",href:"https://hyperledger.github.io/anoncreds-spec/"},"AnonCreds Specification"),". Only ",(0,r.kt)("inlineCode",{parentName:"li"},"did:indy")," issuer identifiers are allowed (based on the ",(0,r.kt)("a",{parentName:"li",href:"https://hyperledger.github.io/anoncreds-methods-registry/#didindy-anoncreds-method"},(0,r.kt)("inlineCode",{parentName:"a"},"did:indy")," AnonCreds Method"),"), so the network can be inferred from the issuer identifier.")),(0,r.kt)("p",null,"As will be explained in the ",(0,r.kt)("a",{parentName:"p",href:"#manually-register-anoncreds-support-in-credentials-and-proofs-modules"},"Manually Register AnonCreds Support in Credentials and Proofs Modules"),", you can still use the unqualified issuer identifiers (best known as the ",(0,r.kt)("a",{parentName:"p",href:"https://hyperledger.github.io/anoncreds-methods-registry/#hyperledger-indy-legacy-anoncreds-method"},"Hyperleger Indy Legacy AnonCreds Method"),") in credential and proof exchanges."),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{label:"0.3.x",value:"tab1",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Agent } from '@aries-framework/core'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\nconst agent = new Agent({\n  config: {\n    /* ... */\n    publicDidSeed: '01eafa4de4e22ed4fc2ee522b6ce2731',\n    indyLedgers: [\n      {\n        id: 'Sovrin Mainnet',\n        indyNamespace: 'sovrin',\n        isProduction: true,\n        genesisPath: './genesis/sovrin-genesis.txn',\n      },\n    ],\n  },\n  dependencies: agentDependencies,\n})\n\nawait agent.initialize()\n\nconst schema = await agent.ledger.registerSchema({\n  attributes: ['name'],\n  name: 'Example Schema',\n  version: '1.0.1',\n})\n\nconst credentialDefinition = await agent.ledger.registerCredentialDefinition({\n  schema,\n  supportRevocation: false,\n  tag: 'default',\n})\n"))),(0,r.kt)(o.Z,{label:"0.4.x",value:"tab2",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { AnonCredsModule } from '@aries-framework/anoncreds'\nimport { Agent, DidsModule, KeyType, TypedArrayEncoder } from '@aries-framework/core'\nimport { IndySdkAnonCredsRegistry, IndySdkModule, IndySdkIndyDidResolver } from '@aries-framework/indy-sdk'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\n// Import from indy-sdk-react-native in React Native\nimport indySdk from 'indy-sdk'\n\nconst agent = new Agent({\n  config: {\n    /* ... */\n  },\n  dependencies: agentDependencies,\n  modules: {\n    indySdk: new IndySdkModule({\n      indySdk,\n      networks: [\n        {\n          id: 'Sovrin Mainnet',\n          indyNamespace: 'sovrin',\n          isProduction: true,\n          genesisPath: './genesis/sovrin-genesis.txn',\n        },\n      ],\n    }),\n    // Important: register the IndySdkAnonCredsRegistry so that the anoncreds module can resolver/register anoncreds objects based on the networks configured in the IndySdkModule\n    anoncreds: new AnonCredsModule({\n      registries: [new IndySdkAnonCredsRegistry()],\n    }),\n    // Important: register the IndySdkIndyDidResolver so that the anoncreds module can resolve DIDs based on the networks configured in the IndySdkModule\n    dids: new DidsModule({\n      resolvers: [new IndySdkIndyDidResolver()],\n    }),\n  },\n})\n\n// Agent MUST be inialized before the anoncreds module can be used\nawait agent.initialize()\n\n// Important: the issuerId (did) MUST be availalbe to the dids module in the agent. You can either create the did using the dids module, or import it as described in this migration guide.\nconst schemaResult = await agent.modules.anoncreds.registerSchema({\n  schema: {\n    attrNames: ['name'],\n    issuerId: 'did:indy:sovrin:KEPUoXHcswsfsHkXGfmXB7',\n    name: 'Example Schema',\n    version: '1.0.0',\n  },\n  options: {},\n})\n\n// The resolver and registrar follow the same pattern as the Did Registration\n// and Did Resolver interfaces as used by the did module.\nif (schemaResult.schemaState.state !== 'finished') {\n  console.error(schemaResult)\n  throw new Error(`Error creating schema`)\n}\n\nconst credentialDefinitionResult = await agent.modules.anoncreds.registerCredentialDefinition({\n  credentialDefinition: {\n    issuerId: 'did:indy:sovrin:KEPUoXHcswsfsHkXGfmXB7',\n    schemaId: schemaResult.schemaState.schemaId,\n    tag: 'default',\n  },\n  options: {},\n})\n")))),(0,r.kt)("h3",{id:"changes-to-the-credentials-and-proofs-modules"},"Changes to the Credentials and Proofs modules"),(0,r.kt)("p",null,"A lot of small, and some bigger changes have been made to the Credentials, and primarily, the Proofs modules. These changes have been made to make the modules more consitent and generic so that they can be used in a wider range of use cases, removing any focus on AnonCreds and Indy credentials."),(0,r.kt)("p",null,"Changes to the Proofs module include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getRequestedCredentialsForProofRequest")," has been renamed to ",(0,r.kt)("inlineCode",{parentName:"li"},"getCredentialsForRequest")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"autoSelectCredentialsForProofRequest")," has been renamed to ",(0,r.kt)("inlineCode",{parentName:"li"},"selectCredentialsForRequest")),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"config")," parameter for both methods has been removed and those have been replaced by proof format specific configuration options. In this case, the ",(0,r.kt)("inlineCode",{parentName:"li"},"config.filterByNonRevocationRequirements")," has been added as ",(0,r.kt)("inlineCode",{parentName:"li"},"proofFormats.indy.filterByNonRevocationRequirements")," (if the ",(0,r.kt)("inlineCode",{parentName:"li"},"indy")," format is registerd as explained in the next section). The ",(0,r.kt)("inlineCode",{parentName:"li"},"config.filterByPresentationPreview")," has been removed as the presentation preview was only present in the present proof V1 protocol, and due to it's limited applicability (the holder starts with a proposal) we've decided to remove this method for now. You can still filter the credentials yourself by using the ",(0,r.kt)("inlineCode",{parentName:"li"},"getCredentialsForRequest")," method."),(0,r.kt)("li",{parentName:"ul"},"Interfaces have been renamed to be more consistent with the method names. Please refere to the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/hyperledger/aries-framework-javascript/blob/v0.4.0/packages/core/src/modules/credentials/CredentialsApiOptions.ts"},(0,r.kt)("inlineCode",{parentName:"a"},"CredentialsApiOptions"))," and ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/hyperledger/aries-framework-javascript/blob/v0.4.0/packages/core/src/modules/proofs/ProofsApiOptions.ts"},(0,r.kt)("inlineCode",{parentName:"a"},"ProofsApiOptions"))," for the interface names that can be imported.")),(0,r.kt)("p",null,"If you encounter any other breaking changes in the Proofs and Credentials modules, please open an issue in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/aries-javascript-docs"},"Aries JavaScript Docs")," repository."),(0,r.kt)("h3",{id:"changes-to-the-anoncreds-credential-and-proof-format"},"Changes to the AnonCreds Credential and Proof Format"),(0,r.kt)("p",null,"With the 0.4.0 release, AFJ now provides a pluggable AnonCreds interface, and requires support AnonCreds credentials to be explicitly registered on the agent. This is also the case for registering the credential and proof formats."),(0,r.kt)("p",null,"In 0.3.x the ",(0,r.kt)("inlineCode",{parentName:"p"},"IndyProofFormatService")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"IndyCredentialFormatService")," were registered by default. In 0.4.x, these services are no longer registered by default and they should be imported from the ",(0,r.kt)("inlineCode",{parentName:"p"},"@aries-framework/anoncreds")," package as ",(0,r.kt)("inlineCode",{parentName:"p"},"LegacyIndyProofFormatService")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"LegacyIndyCredentialFormatService")," and are based on ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/aries-rfcs/blob/main/features/0592-indy-attachments/README.md"},"Aries RFC 0592"),". In a future version the new ",(0,r.kt)("inlineCode",{parentName:"p"},"AnonCredsCredentialFormatService")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"AnonCredsProofFormatService")," will be added to the AnonCreds package, which are based on ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/aries-rfcs/pull/771"},"Aries RFC 0771")," and allow for AnonCreds credentials to be exchanged based on the new ledger agnostic ",(0,r.kt)("a",{parentName:"p",href:"https://hyperledger.github.io/anoncreds-spec/"},"AnonCreds Specification"),"."),(0,r.kt)("p",null,"In addition, the ",(0,r.kt)("inlineCode",{parentName:"p"},"V1CredentialProtocol")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"V1ProofProtocol")," have been extracted into the ",(0,r.kt)("inlineCode",{parentName:"p"},"@aries-framework/anoncreds")," package, as they only support exchange of (legacy Indy) AnonCreds credentials."),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{label:"0.3.x",value:"tab1",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Agent } from '@aries-framework/core'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\nconst agent = new Agent({\n  config: {\n    /* ... */\n    indyLedgers: [\n      {\n        id: 'Sovrin Mainnet',\n        indyNamespace: 'sovrin',\n        isProduction: true,\n        genesisPath: './genesis/sovrin-genesis.txn',\n      },\n    ],\n  },\n  dependencies: agentDependencies,\n})\n"))),(0,r.kt)(o.Z,{label:"0.4.x",value:"tab2",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import {\n  AnonCredsModule,\n  LegacyIndyCredentialFormatService,\n  LegacyIndyProofFormatService,\n  V1CredentialProtocol,\n  V1ProofProtocol,\n} from '@aries-framework/anoncreds'\nimport { Agent, CredentialsModule, ProofsModule, V2CredentialProtocol, V2ProofProtocol } from '@aries-framework/core'\nimport { IndySdkAnonCredsRegistry, IndySdkModule } from '@aries-framework/indy-sdk'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\n// Import from indy-sdk-react-native in React Native\nimport indySdk from 'indy-sdk'\n\nconst legacyIndyCredentialFormat = new LegacyIndyCredentialFormatService()\nconst legacyIndyProofFormat = new LegacyIndyProofFormatService()\n\nconst agent = new Agent({\n  config: {\n    /* ... */\n  },\n  dependencies: agentDependencies,\n  modules: {\n    indySdk: new IndySdkModule({\n      indySdk,\n      networks: [\n        {\n          id: 'Sovrin Mainnet',\n          indyNamespace: 'sovrin',\n          isProduction: true,\n          genesisPath: './genesis/sovrin-genesis.txn',\n        },\n      ],\n    }),\n    // Important: the AnonCreds module MUST be registered with a registry that can resolve\n    // legacy unqualified Indy anoncreds identifiers\n    anoncreds: new AnonCredsModule({\n      registries: [new IndySdkAnonCredsRegistry()],\n    }),\n    // Define the proofs module with support for both v1 and v2 of the proof protocols\n    // both of which support the legacy Indy proof format\n    proofs: new ProofsModule({\n      proofProtocols: [\n        new V1ProofProtocol({\n          indyProofFormat: legacyIndyProofFormat,\n        }),\n        new V2ProofProtocol({\n          proofFormats: [legacyIndyProofFormat],\n        }),\n      ],\n    }),\n    // Define the credentials module with support for both v1 and v2 of the credential protocols\n    // both of which support the legacy Indy proof format\n    credentials: new CredentialsModule({\n      credentialProtocols: [\n        new V1CredentialProtocol({\n          indyCredentialFormat: legacyIndyCredentialFormat,\n        }),\n        new V2CredentialProtocol({\n          credentialFormats: [legacyIndyCredentialFormat],\n        }),\n      ],\n    }),\n  },\n})\n")))),(0,r.kt)("h3",{id:"removal-of-anoncreds-master-secret-maangement-from-wallet"},"Removal of AnonCreds Master Secret maangement from ",(0,r.kt)("inlineCode",{parentName:"h3"},"Wallet")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Wallet")," class no longer manages the creation and deletion of AnonCreds master secrets (which are now called Link Secrets in AnonCreds module and specification). If you haven't provided a custom ",(0,r.kt)("inlineCode",{parentName:"p"},"masterSecretId")," to the ",(0,r.kt)("inlineCode",{parentName:"p"},"walletConfig")," before, the storage migration script should have automatically created an ",(0,r.kt)("inlineCode",{parentName:"p"},"AnonCredsLinkSecretRecord")," for you based on the ",(0,r.kt)("inlineCode",{parentName:"p"},"walletConfig.id"),"."),(0,r.kt)("p",null,"For new agents however, you now need to explicitly create a link secret before you can create requests for AnonCreds credential offers. You can do this using the ",(0,r.kt)("inlineCode",{parentName:"p"},"AnonCredsApi.createLinkSecret")," method."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"If you previously used a custom ",(0,r.kt)("inlineCode",{parentName:"p"},"masterSecertId")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"walletConfig")," the migration script will have created an incorrect ",(0,r.kt)("inlineCode",{parentName:"p"},"AnonCredsLinkSecretRecord")," based on the ",(0,r.kt)("inlineCode",{parentName:"p"},"walletConfig.id"),". You will need to manually override the link secret record with the correct ",(0,r.kt)("inlineCode",{parentName:"p"},"linkSecretId"),"."),(0,r.kt)("p",{parentName:"admonition"},"You ",(0,r.kt)("strong",{parentName:"p"},"ONLY")," need to do this if you're not migrating from Indy SDK to Askar, as in that case the migration script will have created the correct ",(0,r.kt)("inlineCode",{parentName:"p"},"AnonCredsLinkSecretRecord")," for you."),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { AnonCredsLinkSecretRepository } from '@aries-framework/anoncreds'\n\nconst linkSecretRepository = agent.dependencyManager.resolve(AnonCredsLinkSecretRepository)\nconst defaultLinkSecret = await linkSecretRepository.findDefault(agent.context)\n\nif (defaultLinkSecret) {\n  defaultLinkSecret.linkSecretId = 'my-custom-link-secret-id'\n  await linkSecretRepository.update(agent.context, defaultLinkSecret)\n}\n"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { AnonCredsModule } from '@aries-framework/anoncreds'\nimport { Agent } from '@aries-framework/core'\nimport { IndySdkAnonCredsRegistry, IndySdkModule } from '@aries-framework/indy-sdk'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\n// Import from indy-sdk-react-native in React Native\nimport indySdk from 'indy-sdk'\n\nconst agent = new Agent({\n  config: {\n    /* ... */\n  },\n  dependencies: agentDependencies,\n  modules: {\n    indySdk: new IndySdkModule({\n      indySdk,\n    }),\n    anoncreds: new AnonCredsModule({\n      registries: [new IndySdkAnonCredsRegistry()],\n    }),\n  },\n})\n\nawait agent.modules.anoncreds.createLinkSecret({\n  // first one will be set to default automatically\n  setAsDefault: true,\n\n  // will be generated if not provided.\n  // linkSecretId: 'link-secret-id'\n})\n")),(0,r.kt)("h3",{id:"default-outbound-didcomm-content-type-now-applicationdidcomm-envelope-enc"},"Default Outbound DIDComm Content Type now ",(0,r.kt)("inlineCode",{parentName:"h3"},"application/didcomm-envelope-enc")),(0,r.kt)("p",null,"The default outbound DIDComm content type has been changed from ",(0,r.kt)("inlineCode",{parentName:"p"},"DidCommMimeType.V0")," (",(0,r.kt)("inlineCode",{parentName:"p"},"application/ssi-agent-wire"),") to ",(0,r.kt)("inlineCode",{parentName:"p"},"DidCommMimeType.V1")," (",(0,r.kt)("inlineCode",{parentName:"p"},"application/didcomm-envelope-enc"),"). V1 is the default for DIDComm v1 (as ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/aries-rfcs/blob/main/features/0044-didcomm-file-and-mime-types/README.md#detecting-didcomm-versions"},"defined in Aries RFC 0044"),". In the past V0 resulted in better interoperaiblity, but since it's the default for so long it makes sense to change the default behaviour."),(0,r.kt)("p",null,"It is advised to use the default value as configured by the agent (V1). If you want to keep the old behaviour, you can ",(0,r.kt)("a",{parentName:"p",href:"/guides/tutorials/agent-config#didcommmimetype"},"configure the ",(0,r.kt)("inlineCode",{parentName:"a"},"didCommMimeType")," property in the agent config"),"."),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{label:"0.3.x",value:"tab1",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Agent } from '@aries-framework/core'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\nconst agent = new Agent({\n  config: {\n    /* ... */\n  },\n  dependencies: agentDependencies,\n})\n"))),(0,r.kt)(o.Z,{label:"0.4.x",value:"tab2",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Agent, DidCommMimeType } from '@aries-framework/core'\n\n// Import from @aries-framework/react-native in React Native\nimport { agentDependencies } from '@aries-framework/node'\n\nconst agent = new Agent({\n  config: {\n    didCommMimeType: DidCommMimeType.V0,\n  },\n  dependencies: agentDependencies,\n})\n")))),(0,r.kt)("h3",{id:"generalizing-indy-properties-in-credentialexchangerecord"},"Generalizing Indy properties in ",(0,r.kt)("inlineCode",{parentName:"h3"},"CredentialExchangeRecord")),(0,r.kt)("p",null,"With AnonCreds credentials now being generalized to support multiple ledgers, the properties specific to Hyperledger Indy have now been generalized into a generic anoncreds properties."),(0,r.kt)("h4",{id:"credentialrecordtype"},(0,r.kt)("inlineCode",{parentName:"h4"},"credentialRecordType")),(0,r.kt)("p",null,"First off, the ",(0,r.kt)("inlineCode",{parentName:"p"},"credentialRecordType")," that was used to reference stored AnonCreds credentials has been renamed from ",(0,r.kt)("inlineCode",{parentName:"p"},"indy")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"anoncreds"),". The migration script takes care of the update to the storage, but you need to make sure to update all places that expect a ",(0,r.kt)("inlineCode",{parentName:"p"},"credentialRecordType")," of ",(0,r.kt)("inlineCode",{parentName:"p"},"indy")," to be defined."),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{label:"0.3.x",value:"tab1",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="CredentialExchangeRecord"',title:'"CredentialExchangeRecord"'},'{\n  "credentials": [\n    {\n      "credentialRecordType": "indy",\n      "credentialRecordId": "credential-id"\n    }\n  ]\n}\n'))),(0,r.kt)(o.Z,{label:"0.4.x",value:"tab2",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="CredentialExchangeRecord"',title:'"CredentialExchangeRecord"'},'{\n  "credentials": [\n    {\n      "credentialRecordType": "anoncreds",\n      "credentialRecordId": "credential-id"\n    }\n  ]\n}\n')))),(0,r.kt)("h4",{id:"metadata"},"Metadata"),(0,r.kt)("p",null,"Second, the metadata keys and values have been renamed to be anoncreds specific rather than indy specific. The ",(0,r.kt)("inlineCode",{parentName:"p"},"CredentialMetadataKeys")," have been replaced by the ",(0,r.kt)("inlineCode",{parentName:"p"},"AnonCredsCredentialMetadataKey")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"AnonCredsCredentialRequestMetadataKey")," constants which can be imported from the ",(0,r.kt)("inlineCode",{parentName:"p"},"@aries-framework/anoncreds")," package."),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{label:"0.3.x",value:"tab1",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="CredentialExchangeRecord"',title:'"CredentialExchangeRecord"'},'{\n  "metadata": {\n    "_internal/indyCredential": {\n      "schemaId": "schema-id",\n      "credentialDefinitionId": "cred-def-id",\n      "indyRevocationRegistryId": "rev-reg-id",\n      "indyCredentialRevocationId": "cred-rev-id"\n    },\n    "_internal/indyRequest": {\n      "master_secret_blinding_data": {\n        "v_prime": "string",\n        "vr_prime": "string"\n      },\n      "master_secret_name": "string",\n      "nonce": "string"\n    }\n  }\n}\n'))),(0,r.kt)(o.Z,{label:"0.4.x",value:"tab2",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="CredentialExchangeRecord"',title:'"CredentialExchangeRecord"'},'{\n  "metadata": {\n    "_anoncreds/credential": {\n      "schemaId": "schema-id",\n      "credentialDefinitionId": "cred-def-id",\n      "revocationRegistryId": "rev-reg-id",\n      "credentialRevocationId": "cred-rev-id"\n    },\n    "_anoncreds/credentialRequest": {\n      "master_secret_blinding_data": {\n        "v_prime": "string",\n        "vr_prime": "string"\n      },\n      "master_secret_name": "string",\n      "nonce": "string"\n    }\n  }\n}\n')))),(0,r.kt)("h3",{id:"more-paths-in-filesystem"},"More paths in ",(0,r.kt)("inlineCode",{parentName:"h3"},"FileSystem")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"FileSystem")," interface has been extended to support multiple base paths. The previous interface had a single ",(0,r.kt)("inlineCode",{parentName:"p"},"basePath")," property which was used for storing of files across the framework."),(0,r.kt)("p",null,"With the different lifetimes of different objects, the ",(0,r.kt)("inlineCode",{parentName:"p"},"FileSystem")," interface has been extended to now support three different base paths:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"cachePath")," - files used for caching purposes. It's okay if the files are cleared from time to time."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"dataPath")," - files that are used for long-term reliable storage purposes. These files will never be cleared."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"tempPath")," - files that are used for temporary storage purposes. It's okay if the files are cleared from time to time.")),(0,r.kt)("p",null,"If you're using the framework, you don't need to worry about this change. The agent may need to download some objects again after the update. If you've made a custom imlpementation of the ",(0,r.kt)("inlineCode",{parentName:"p"},"FileSystem"),", make sure to support all three base paths, and make sure to correclty handle the lifecycle of the files. ITems stored under the ",(0,r.kt)("inlineCode",{parentName:"p"},"dataPath")," ",(0,r.kt)("strong",{parentName:"p"},"should never be cleared"),"."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Indy SDK SQLite wallets do not use the paths defined by the ",(0,r.kt)("inlineCode",{parentName:"p"},"FileSystem")," interface, and thus will not be influenced by this change. When upgrading to Aries Askar, the ",(0,r.kt)("inlineCode",{parentName:"p"},"dataPath")," will be used as the base path for storing the SQLite wallet data.")),(0,r.kt)("h2",{id:"breaking-storage-changes"},"Breaking Storage Changes"),(0,r.kt)("p",null,"The 0.4.0 release introduces some breaking changes to the storage format."),(0,r.kt)("p",null,"Below all breaking storage changes are explained in as much detail as possible. The update assistant provides all tools to migrate without a hassle, but it is important to know what has changed. All examples only show the keys that have changed, unrelated keys in records have been omitted."),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/guides/next/updating/update-assistant"},"Update Assistant")," documentation for a guide on how to use the update assistant."),(0,r.kt)("p",null,"There are no config parameters to be provided to the update assistant to migrate from 0.3.x to 0.4.x."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"TODO")))}h.isMDXComponent=!0}}]);